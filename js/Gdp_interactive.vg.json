{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "params": [
    {
      "name": "continent_filter",
      "bind": {
        "input": "select",
        "options": [null, "Asia", "Europe", "Africa", "North America", "South America", "Oceania"],
        "labels": ["All Continents", "Asia", "Europe", "Africa", "North America", "South America", "Oceania"],
        "name": "Filter by Continent: "
      }
    },
    {
      "name": "min_gdp",
      "value": 13000,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 100000,
        "step": 1000,
        "name": "Minimum GDP per Capita (US$): "
      }
    }
  ],
  "vconcat": [
    {
      "width": 800,
      "height": 600,
      "title": "Global Economic Analysis: GDP per Capita vs Population",
      "data": {
        "url": "https://raw.githubusercontent.com/henryma0722/3179c2/main/data/merged_economic_data.csv"
      },
      "transform": [
        {
          "calculate": "datum.GDP_2022 / datum.POP_2022",
          "as": "GDP_per_capita"
        },
        {
          "filter": "datum.GDP_per_capita > min_gdp"
        },
        {
          "filter": "continent_filter == null || datum.Continent == continent_filter"
        },
        {
          "filter": "datum.GDP_2022 > 0 && datum.POP_2022 > 0"
        }
      ],
      "encoding": {
        "x": {
          "field": "POP_2022",
          "type": "quantitative",
          "title": "Population",
          "axis": {
            "format": ".0s",
            "values": [1000, 10000, 100000, 1000000, 10000000, 100000000, 1000000000000, 10000000000000]
          },
          "scale": {"type": "log"}
        },
        "y": {
          "field": "GDP_per_capita",
          "type": "quantitative",
          "title": "GDP per Capita (US$)",
          "axis": {
            "format": "$,.0f",
            "values": [1000, 10000, 100000, 1000000]
          },
          "scale": {"type": "log"}
        }
      },
      "layer": [
        {
          "mark": "circle",
          "encoding": {
            "size": {
            "field": "GDP_2022",
            "type": "quantitative",
            "title": "Total GDP (US$)",
            "scale": {
              "type": "log",
              "range": [10, 500]  
            },
            "legend": {
              "format": "$.2s",
              "values": [
                10000000000,   
                100000000000,  
                1000000000000,
                10000000000000
              ]
            }
          },
            "color": {
              "field": "Continent",
              "type": "nominal",
              "title": "Continent",
              "scale": {
                "domain": ["Asia", "Europe", "Africa", "North America", "South America", "Oceania"],
                "range": ["#e41a1c", "#984ea3", "#ff7f00", "#a6cee3", "#377eb8", "#a65628"]
              }
            },
            "opacity": {"value": 0.6},
            "tooltip": [
              {"field": "Country Name", "type": "nominal", "title": "Country"},
              {"field": "Continent", "type": "nominal", "title": "Continent"},
              {"field": "POP_2022", "type": "quantitative", "title": "Population", "format": ","},
              {"field": "GDP_2022", "type": "quantitative", "title": "Total GDP", "format": "$,.0f"},
              {"field": "GDP_per_capita", "type": "quantitative", "title": "GDP per Capita", "format": "$,.0f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 8,
            "fontSize": 10,
            "fontWeight": "bold"
          },
          "encoding": {
            "text": {"field": "Country Name", "type": "nominal"},
            "color": {"value": "black"},
            "opacity": {
              "condition": {
                "test": "datum['Country Name'] == 'United States' || datum['Country Name'] == 'China' || datum['Country Name'] == 'India' || datum['Country Name'] == 'Luxembourg' || datum['Country Name'] == 'Singapore' || datum['Country Name'] == 'Australia'",
                "value": 1
              },
              "value": 0
            }
          }
        }
      ]
    }
  ],
  "config": {}
}